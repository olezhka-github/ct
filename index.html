<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WCS –ú–µ—Å–µ–Ω–¥–∂–µ—Ä - —Ç–≤–æ—Ä—ñ–Ω–Ω—è xaotiq</title>
  <link rel="icon" href="favicon.ico">
  <link rel="stylesheet" href="style.css">
  <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Alertify –¥–ª—è —Å–ø–æ–≤—ñ—â–µ–Ω—å -->
  <script src="https://cdn.jsdelivr.net/npm/alertifyjs@1.14.0/build/alertify.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.14.0/build/css/alertify.min.css" />
  
  <!-- –í–±—É–¥–æ–≤–∞–Ω—ñ —Å—Ç–∏–ª—ñ -->
 
</head>
<body>
  <!-- –°–µ–∫—Ü—ñ—è –¥–ª—è –≤—Ö–æ–¥—É/—Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó -->
  <!-- From Uiverse.io by Praashoo7 --> 
<div class="form" id="login-section">
  <p id="heading">WCS</p>
  <div class="field">
  <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
  <path d="M13.106 7.222c0-2.967-2.249-5.032-5.482-5.032-3.35 0-5.646 2.318-5.646 5.702 0 3.493 2.235 5.708 5.762 5.708.862 0 1.689-.123 2.304-.335v-.862c-.43.199-1.354.328-2.29.328-2.926 0-4.813-1.88-4.813-4.798 0-2.844 1.921-4.881 4.594-4.881 2.735 0 4.608 1.688 4.608 4.156 0 1.682-.554 2.769-1.416 2.769-.492 0-.772-.28-.772-.76V5.206H8.923v.834h-.11c-.266-.595-.881-.964-1.6-.964-1.4 0-2.378 1.162-2.378 2.823 0 1.737.957 2.906 2.379 2.906.8 0 1.415-.39 1.709-1.087h.11c.081.67.703 1.148 1.503 1.148 1.572 0 2.57-1.415 2.57-3.643zm-7.177.704c0-1.197.54-1.907 1.456-1.907.93 0 1.524.738 1.524 1.907S8.308 9.84 7.371 9.84c-.895 0-1.442-.725-1.442-1.914z"></path>
  </svg>
    <input autocomplete="off" placeholder="–ù—ñ–∫–Ω–µ–π–º" class="input-field" type="text" id="username">
  </div>
  <div class="field">
  <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
  <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"></path>
  </svg>
    <input placeholder="–ü–∞—Ä–æ–ª—å" class="input-field" type="password" id="password">
  </div>
  <div class="btn">
  <button class="button1" id="login-button">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;–í—Ö—ñ–¥&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</button>
  <button class="button2" id="register-button">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</button>
  </div>
  <!--<button class="button3">Forgot Password</button> -->
</div>
  <!-- –°–µ–∫—Ü—ñ—è –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ —á–∞—Ç—É -->
  <div id="chat-section" class="hidden gcard">
    <h3>–í—ñ—Ç–∞—é, <span id="user-welcome"></span>!</h3>
    <div id="chat-area">
      <div id="messages"></div>
    </div>
    <div id="send-message">
      <input type="text" id="message" placeholder="–ù–∞–ø–∏—à–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è">
      <button id="send-button">üì©</button>
    </div>
    <div id="sticker-area">
      <div id="sticker-gallery"></div>
      <div id="upload-form">
        <button type="button" id="sticker-button">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç—ñ–∫–µ—Ä</button>
      </div>
    </div>
    <!-- –ö–µ—Ä—É–≤–∞–Ω–Ω—è –¥–∑–≤—ñ–Ω–∫–æ–º -->
    <div id="call-controls" style="margin-top: 10px;">
      <!-- <button id="joinCall">–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ –¥–∑–≤—ñ–Ω–∫–∞</button>
      <button id="leaveCall" disabled>–ü–æ–∫–∏–Ω—É—Ç–∏ –¥–∑–≤—ñ–Ω–æ–∫</button> -->
    </div>
  </div>

  <!-- –ë–ª–æ–∫ –∞–¥–º—ñ–Ω–ø–∞–Ω–µ–ª—ñ -->
  <div class="hidden gcard" id="adminpanelen">
    <h3>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å. –ü–æ–≤–æ–¥—å—Å—è –∞–¥–µ–∫–≤–∞—Ç–Ω–æ, –∞ —Ç–æ –≤—ñ–¥–ª–µ—Ç–∏—à —è–∫ –≤—Å—ñ —à–∞—Ö—Ä–∞—ó</h3>
    <div id="ban-panel">
      <label for="user-select">–û–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:</label>
      <select id="usernameToBan"></select>
      <br><br>
      <button id="banButton" onclick="TryToBanUser()">–ó–∞–±–∞–Ω–∏—Ç–∏</button>
      <button id="unbanButton" onclick="TryToBanUser()">–†–æ–∑–±–∞–Ω–∏—Ç–∏</button>
    </div>
  </div>

  <!-- –°–µ–∫—Ü—ñ—è –ø—Ä–∏–≤–∞—Ç–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å -->
  <div class="hidden gcard" id="private-section">
    <div id="messagesP"></div>
    <p>–û–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: <span id="chosen-user"></span></p>
    <select id="checkbox-users">
     
    </select>
    <div id="send-message">
      <input type="text" id="prvamsg" placeholder="–í–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è">
      <button id="send-private">üì©</button>
    </div>
  </div>

  <!-- –°–µ–∫—Ü—ñ—è –ø—Ä–æ—Ñ—ñ–ª—é ("–ü—Ä–æ —Å–µ–±–µ") -->
  <div class="hidden gcard" id="profile-section">
    <h3>–ü—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: <span id="profile-username"></span></h3>
    <h4>–ü—Ä–æ —Å–µ–±–µ</h4>
    <p id="profile-about">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
    <textarea id="edit-about" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Å–µ–±–µ..." rows="4" style="width: 100%;"></textarea>
    <button id="save-about" style="margin-top: 10px; padding: 10px 20px;">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
  </div>

  <!-- –°–µ–∫—Ü—ñ—è –ø—Ä–µ—Ñ—ñ–∫—Å—ñ–≤ -->
  <div id="prefix-section" class="hidden gcard">
    <h3>–û–±–µ—Ä—ñ—Ç—å —Å–≤—ñ–π –ø—Ä–µ—Ñ—ñ–∫—Å:</h3>
    <div id="prefix-options">
      <label>
        <input type="radio" name="prefix" value="[üíôüíõ]">
        üíôüíõ
      </label>
      <label>
        <input type="radio" name="prefix" value="[üî•]">
        üî•
      </label>
      <label>
        <input type="radio" name="prefix" value="[‚≠ê]">
        ‚≠ê
      </label>
      <label>
        <input type="radio" name="prefix" value="[üíé]">
        üíé
      </label>
      <label>
        <input type="radio" name="prefix" value="">
        (–ë–µ–∑ –ø—Ä–µ—Ñ—ñ–∫—Å—É)
      </label>
      <label>
        <input type="radio" name="prefix" value="[–ß–Ü–ù–ê–ó–ï–°]">
        –ß–Ü–ù–ê–ó–ï–°
      </label>
      <label>
        <input type="radio" name="prefix" value="[–∫–µ—Ñ—Ç–µ–º–µ]">
        –∫–µ—Ñ—Ç–µ–º–µ
      </label>
      <label>
        <input type="radio" name="prefix" value="[–ü–æ—Ç—É–∂–Ω–æ]">
        –ü–æ—Ç—É–∂–Ω–æ
      </label>
      <label>
        <input type="radio" name="prefix" value="[–∞–±–∞—é–¥–Ω–∞]">
        –∞–±–∞—é–¥–Ω–∞
      </label>
      <label>
        <input type="radio" name="prefix" value="[UKRaine]">
        UKRaine
      </label>
    </div>
    <button id="save-prefix" class="flip-card__btn">–ó–±–µ—Ä–µ–≥—Ç–∏ –ø—Ä–µ—Ñ—ñ–∫—Å</button>
  </div>

  <!-- Radio-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ä–µ–∂–∏–º—ñ–≤ -->
  <div id="radio-section" class="hidden radio-inputs" style="display: none;">
    <label class="radio">
      <input type="radio" name="radio" checked value="forum">
      <span class="name">–§–æ—Ä—É–º</span>
    </label>
    <label class="radio">
      <input type="radio" name="radio" value="private">
      <span class="name">–ü—Ä–∏–≤–∞—Ç–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</span>
    </label>
    <label class="radio">
      <input type="radio" name="radio" value="profile">
      <span class="name">–ü—Ä–æ—Ñ—ñ–ª—å</span>
    </label>
    <label class="radio">
      <input type="radio" name="radio" value="prefix">
      <span class="name">–ü—Ä–µ—Ñ—ñ–∫—Å–∏</span>
    </label>
    <br>
    <label class="radio hidden" id="ban-radio">
      <input type="radio" name="radio" value="bans">
      <span class="nameA">–ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å</span>
    </label>
    <label class="radio" id="wv-radio" onclick="window.location = 'https://wcsvoicebeta.onrender.com'">
      <input type="radio" name="radio" value="wcsvoice">
      <span class="name">–í—ñ–¥–µ–æ –∑–≤'—è–∑–æ–∫</span>
    </label>
  </div>

  <script>
    let ws;
    let currentUsername;
    let currentPrefix = ""; // –ó–º—ñ–Ω–Ω–∞ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤–∏–±—Ä–∞–Ω–æ–≥–æ –ø—Ä–µ—Ñ—ñ–∫—Å—É


    // DOM-–µ–ª–µ–º–µ–Ω—Ç–∏
    const loginSection = document.getElementById('login-section');
    const chatSection = document.getElementById('chat-section');
    const privateSection = document.getElementById('private-section');
    const profileSection = document.getElementById('profile-section');
    const prefixSection = document.getElementById('prefix-section');
    const messagesDiv = document.getElementById('messages');
    const messagesP = document.getElementById('messagesP');
    const loginButton = document.getElementById('login-button');
    const sendButton = document.getElementById('send-button');
    const stickerButton = document.getElementById('sticker-button');
    const userWelcome = document.getElementById('user-welcome');
    const registerButton = document.getElementById('register-button');
    const radioSectionDiv = document.getElementById('radio-section');
    const sendPrivate = document.getElementById('send-private');
    const prvmsg = document.getElementById('prvamsg');
    const userNav = document.getElementById('usernav');
    const chosenUser = document.getElementById('chosen-user');
    const profileUsername = document.getElementById('profile-username');
    const profileAbout = document.getElementById('profile-about');
    const editAbout = document.getElementById('edit-about');
    const saveAbout = document.getElementById('save-about');
    const banRadio = document.getElementById('ban-radio');
    const admin = document.getElementById('adminpanelen');
    const usernameToBan = document.getElementById('usernameToBan');
    const savePrefixBtn = document.getElementById('save-prefix');
    const checkboxUsers = document.getElementById('checkbox-users')

    // –ü–æ—á–∞—Ç–∫–æ–≤–µ –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è —Å–µ–∫—Ü—ñ–π
    privateSection.style.display = 'none';
    profileSection.style.display = 'none';
    prefixSection.style.display = 'none';

    // WebSocket URL
    const url = "wss://ctserver.onrender.com/";

    // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ä–µ–∂–∏–º—ñ–≤ (radio-–∫–Ω–æ–ø–∫–∏)
    document.querySelectorAll('input[name="radio"]').forEach(radio => {
      radio.addEventListener('change', function () {
        const selectedValue = document.querySelector('input[name="radio"]:checked').value;
        // –•–æ–≤–∞—î–º–æ –≤—Å—ñ —Å–µ–∫—Ü—ñ—ó
        chatSection.style.display = 'none';
        privateSection.style.display = 'none';
        profileSection.style.display = 'none';
        prefixSection.style.display = 'none';
        admin.style.display = 'none';
        if (selectedValue === "forum") {
          chatSection.style.display = 'flex';
        } else if (selectedValue === "private") {
          privateSection.style.display = 'flex';
        } else if (selectedValue === "profile") {
          profileSection.style.display = 'flex';
          loadProfile();
        } else if (selectedValue === "prefix") {
          prefixSection.style.display = 'flex';
        } else if (selectedValue === "bans") {
          admin.style.display = 'flex';
        }
      });
    });

    // –û–±—Ä–æ–±–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤–∏–±—Ä–∞–Ω–æ–≥–æ –ø—Ä–µ—Ñ—ñ–∫—Å–∞
    savePrefixBtn.addEventListener('click', () => {
      const selected = document.querySelector('input[name="prefix"]:checked');
      if (selected) {
        currentPrefix = selected.value;
        alertify.success('–ü—Ä–µ—Ñ—ñ–∫—Å –∑–±–µ—Ä–µ–∂–µ–Ω–æ: ' + (currentPrefix ? currentPrefix : "(–±–µ–∑ –ø—Ä–µ—Ñ—ñ–∫—Å—É)"));
      } else {
        alertify.error('–û–±–µ—Ä—ñ—Ç—å –ø—Ä–µ—Ñ—ñ–∫—Å');
      }
    });

    // –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
    registerButton.addEventListener('click', () => {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      if (!username || !password) {
        alertify.error('–í–≤–µ–¥—ñ—Ç—å –¥–∞–Ω—ñ –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó');
        return;
      }
      ws = new WebSocket(url);
      ws.onopen = () => {
        ws.send(JSON.stringify({ action: 'create_account', username, password }));
      };
      ws.onmessage = (event) => {
        const response = JSON.parse(event.data);
        console.log(response);
        if (response.action === 'createAccount') {
          if (response.success) {
            alertify.success('–í–∏ –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞–ª–∏—Å—å, —Ç–µ–ø–µ—Ä –º–æ–∂–µ—Ç–µ —É–≤—ñ–π—Ç–∏.');
            
          } else {
            alertify.error(response.message || '–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó');
          }
        }
      };
      ws.onerror = (error) => {
        console.error('WebSocket error:', error);
      };
    });

    // –í—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    loginButton.addEventListener('click', () => {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      if (!username || !password) {
        alertify.error('–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è –≤—Ö–æ–¥—É');
        return;
      }
      ws = new WebSocket(url);
      ws.onopen = () => {
        ws.send(JSON.stringify({ action: 'login', username, password }));
      };
      ws.onmessage = async (event) => {
        const response = JSON.parse(event.data);
        console.log(response);
        if (response.action === 'login') {
          if (response.success) {
            currentUsername = username;
            loginSection.classList.add('hidden');
            loginSection.classList.remove('form')
            chatSection.classList.remove('hidden');
            privateSection.classList.remove('hidden');
            radioSectionDiv.style.display = 'flex';
            userWelcome.textContent = currentUsername;
            profileUsername.textContent = currentUsername;
            if (['hideyoshi.xaotiq', 'moderator.roman'].includes(currentUsername)) {
              banRadio.classList.remove('hidden');
            } else {
              if(banRadio.parentNode) banRadio.parentNode.removeChild(banRadio);
              if(admin.parentNode) admin.parentNode.removeChild(admin);
            }
            loadFriendList();
            loadChatHistory();
          } else {
            alertify.error(response.message);
          }
        } else if (response.action === 'new_message') {
          if (response.type === 'sticker') {
            displaySticker(response.username, response.stickerUrl);
          } else {
            displayMessage(response.username, response.message, response.prefix);
          }
        } else if (response.action === 'loadChatHistory') {
          response.chatHistory.forEach(msg => {
            if (msg.type === 'message') {
              displayMessage(msg.username, msg.message, msg.prefix);
            } else if (msg.type === 'sticker') {
              displaySticker(msg.username, msg.stickerUrl);
            }
          });
        } else if (response.action === 'private_message') {
          if (response.recipient === currentUsername) {
            displayPrivate(response.from, response.message);
          } else if (response.from === currentUsername) {
           // displayPrivate(`–í–∏ –¥–æ ${response.recipient}`, response.message);
          }
        } else if (response.action === 'get_profile') {
          if (response.success) {
            profileAbout.textContent = '–ü—Ä–æ —Å–µ–±–µ = ' + (response.about || '–ù–µ–º–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó');
            editAbout.value = response.about || '';
          } else {
            profileAbout.textContent = '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é';
          }
        } else if (response.action === 'update_profile') {
          if (response.success) {
            profileAbout.textContent = '–ü—Ä–æ —Å–µ–±–µ = ' + (response.about || '–ù–µ–º–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó');
            alertify.success('–ü—Ä–æ—Ñ—ñ–ª—å –æ–Ω–æ–≤–ª–µ–Ω–æ');
          } else {
            alertify.error(response.message);
          }
        } else if (response.action === 'loadUserList') {
          // –û—Ç—Ä–∏–º–∞–ª–∏ –º–∞—Å–∏–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞
          loadUserList(response.users);
        }
        // –û–±—Ä–æ–±–∫–∞ WebRTC —Å–∏–≥–Ω–∞–ª—ñ–≤ (—è–∫—â–æ —î)
      };
      ws.onerror = (error) => {
        console.error('WebSocket error:', error);
      };
    });

    // –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º
    sendButton.addEventListener('click', () => {
      const message = document.getElementById('message').value.trim();
      if (message) {
        ws.send(JSON.stringify({ 
          action: 'send_message', 
          username: currentUsername, 
          message, 
          prefix: currentPrefix 
        }));
        document.getElementById('message').value = '';
      }
    });

    // –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è —Å—Ç—ñ–∫–µ—Ä–∞
    stickerButton.addEventListener('click', () => {
      const stickerUrl = prompt("–í—Å—Ç–∞–≤—Ç–µ URL-–∞–¥—Ä–µ—Å—É —Å—Ç—ñ–∫–µ—Ä–∞:");
      if (stickerUrl && stickerUrl.trim()) {
        ws.send(JSON.stringify({ action: 'send_sticker', username: currentUsername, stickerUrl }));
      }
    });

    // –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º
    // –û–±—Ä–æ–±–∫–∞ –∑–º—ñ–Ω–∏ –≤–∏–±–æ—Ä—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É –≤–∏–ø–∞–¥–∞—é—á–æ–º—É —Å–ø–∏—Å–∫—É
document.getElementById('checkbox-users').addEventListener('change', function() {
  document.getElementById('chosen-user').textContent = this.value;
});
// –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º
sendPrivate.addEventListener('click', () => {
    const message = document.getElementById('prvamsg').value.trim();
    const recipient = chosenUser .textContent.trim();
    if (message && recipient) {
      ws.send(JSON.stringify({ 
        action: 'private_message', 
        username: currentUsername, 
        recipient, 
        message, 
        prefix: currentPrefix 
      }));
      displayPrivate(currentUsername, message); // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –≤–ª–∞—Å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
      document.getElementById('prvamsg').value = ''; // –û—á–∏—â–∞—î–º–æ –ø–æ–ª–µ –≤–≤–æ–¥—É
    } else {
      alertify.error('–û–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –Ω–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è');
    }
  });


    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –ø—Ä–µ—Ñ—ñ–∫—Å–∞
    function displayMessage(username, message, prefix) {
      const p = document.createElement('p');
      let displayName = username;
      if (prefix && prefix.trim() !== "") {
        displayName = prefix + " " + username;
      }
      p.textContent = `${displayName}: ${message}`;
      messagesDiv.appendChild(p);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ç—ñ–∫–µ—Ä–∞
    function displaySticker(username, stickerUrl) {
      const p = document.createElement('p');
      const img = document.createElement('img');
      img.src = stickerUrl;
      img.alt = "–ù–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π —Å—Ç—ñ–∫–µ—Ä";
      img.classList.add('sticker-image');
      p.appendChild(document.createTextNode(`${username} –Ω–∞–¥—ñ—Å–ª–∞–≤ —Å—Ç—ñ–∫–µ—Ä:`));
      p.appendChild(img);
      messagesDiv.appendChild(p);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    function displayPrivate(from, message) {
    const p = document.createElement('p');
    let displayName = from === currentUsername ? `–í–∏` : from; // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ "–í–∏" –¥–ª—è –≤–ª–∞—Å–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
    p.textContent = `${displayName}: ${message}`;
    messagesP.appendChild(p);
    messagesP.scrollTop = messagesP.scrollHeight; // –ü—Ä–æ–∫—Ä—É—á—É—î–º–æ –≤–Ω–∏–∑
  }


    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —á–∞—Ç—É —Ç–∞ –∞–¥–º—ñ–Ω–ø–∞–Ω–µ–ª—ñ
    function loadFriendList() {
      ws.send(JSON.stringify({ action: 'loadUserList', username: currentUsername }));
    }
    function loadUserList(users) {
  // –û—á–∏—â—É—î–º–æ —Å–ø–∏—Å–æ–∫ –¥–ª—è –∞–¥–º—ñ–Ω–ø–∞–Ω–µ–ª—ñ
  usernameToBan.innerHTML = '';
  // –û—á–∏—â—É—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–µ–∫–±–æ–∫—Å—ñ–≤
  const checkboxContainer = document.getElementById('checkbox-users');
  checkboxContainer.innerHTML = '';

  users.forEach(user => {
    // –î–æ–¥–∞—î–º–æ –æ–ø—Ü—ñ—é –¥–ª—è –∞–¥–º—ñ–Ω–ø–∞–Ω–µ–ª—ñ
    const banoption = document.createElement('option');
    const opt = document.createElement('option')
    banoption.id = user;
    banoption.value = user;
    banoption.text = user;
    opt.text = user;
    opt.value = user;
    checkboxUsers.appendChild(opt)
    usernameToBan.appendChild(banoption);

    // –°—Ç–≤–æ—Ä—é—î–º–æ —á–µ–∫–±–æ–∫—Å –∑ —ñ–º–µ–Ω–µ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    const checkboxWrapper = document.createElement('div');
    checkboxWrapper.className = 'checkbox-wrapper';

    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.id = `checkbox_${user}`;
    checkbox.value = user;
    checkbox.name = 'userCheckbox';

    const label = document.createElement('label');
    label.htmlFor = `checkbox_${user}`;
    label.textContent = user;

    checkboxWrapper.appendChild(checkbox);
    checkboxWrapper.appendChild(label);
    checkboxContainer.appendChild(checkboxWrapper);
  });
}

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ —á–∞—Ç—É
    function loadChatHistory() {
      ws.send(JSON.stringify({ action: 'loadChatHistory', username: currentUsername }));
    }
    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é ("–ü—Ä–æ —Å–µ–±–µ")
    function loadProfile() {
      if (ws && currentUsername) {
        ws.send(JSON.stringify({ action: 'get_profile', username: currentUsername }));
      }
    }
    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –±–∞–Ω—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–∞–¥–º—ñ–Ω)
    function TryToBanUser() {
      const sel_val = usernameToBan.value.trim();
      const tokenprompt = prompt('–í–≤–µ–¥—ñ—Ç—å —Ç–æ–∫–µ–Ω –≤–∑–∞—î–º–æ–¥—ñ—ó');
      const resn = prompt('–í–≤–µ–¥—ñ—Ç—å –ø—Ä–∏—á–∏–Ω—É');
      ws.send(JSON.stringify({ action: 'ban_user', username: sel_val, duration: 10, token: tokenprompt, reason: resn, banned_by: currentUsername }));
    }

    // –ü—Ä–∏–≤‚Äô—è–∑–∫–∞ WebRTC (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
    // joinCallButton.addEventListener('click', joinCall);
    // leaveCallButton.addEventListener('click', leaveCall);
  </script>
  
  <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –∫–ª—ñ–∫—ñ–≤ –ø–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è—Ö –∑ "https://" -->
  <script>
    document.addEventListener('click', function(e) {
      const anchor = e.target.closest('a');
      if (anchor) {
        const href = anchor.getAttribute('href');
        if (href && href.startsWith('https://')) {
          e.preventDefault();
          // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —á–µ—Ä–µ–∑ —Å—Ç–æ—Ä—ñ–Ω–∫—É —Ä–µ–¥—ñ—Ä–µ–∫—Ç—É
          window.location.href = '/redirect?s=' + encodeURIComponent(href);
        }
      }
    });
  </script>
</body>
</html>
